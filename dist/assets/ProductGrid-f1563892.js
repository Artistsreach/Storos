import{r as d,u as R,j as e,m as k,C as Q,L as M,E as X,g as Y,I as A,c as ee,h as te,B as j,i as se,Z as ae,k as oe,l as re,s as ie,n as le,G as ne,A as ce,o as de}from"./index-440cc513.js";import{L as ue}from"./list-5010198e.js";import{F as me}from"./filter-0f312d72.js";const pe=({product:l,theme:m,index:p,storeName:v,storeId:o,isPublishedView:x=!1})=>{var G;const[h,b]=d.useState(l);d.useEffect(()=>{b(l)},[l]);const{name:u,price:w,rating:g,description:P,image:n,currencyCode:T="USD",id:i,stripe_price_id:_,variants:N,inventory_count:f}=h,{addToCart:E,updateStore:S,currentStore:s}=R(),[r,y]=d.useState(!1),[C,$]=d.useState(null),[B,L]=d.useState(!1),U=!x,O=encodeURIComponent(i),q=((G=n==null?void 0:n.src)==null?void 0:G.medium)||(n==null?void 0:n.url)||(Array.isArray(h.images)&&h.images.length>0?h.images[0]:`https://via.placeholder.com/400x400.png?text=${encodeURIComponent(u)}`),z=(n==null?void 0:n.alt)||`${u} product image`,I=async(t,a)=>{if(o&&i)try{console.log(`Attempting to save product ${i}: ${t} = ${a}`);const c={id:i,[t]:a};await fetch(`${{}.VITE_SUPABASE_URL}/functions/v1/manage-product`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("supabase.auth.token")}`},body:JSON.stringify({store_id:o,product_id:i,[t]:a})})}catch(c){console.error(`Failed to update product ${t}:`,c)}},D=t=>{t.preventDefault(),t.stopPropagation(),E(l,o)},J=async t=>{t.preventDefault(),t.stopPropagation(),y(!0),$(null);try{const a=await fetch(`${{}.VITE_SUPABASE_URL}/functions/v1/create-checkout-session`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform_product_id:i,store_id:o,quantity:1})}),c=await a.json();if(!a.ok)throw new Error(c.error||"Failed to create checkout session.");if(c.checkoutUrl)window.location.href=c.checkoutUrl;else if(c.sessionId){const K=await ie,{error:F}=await K.redirectToCheckout({sessionId:c.sessionId});F&&(console.error("Stripe redirect error:",F),$(F.message))}else throw new Error("Checkout session created, but no URL or Session ID returned.")}catch(a){console.error("Checkout error:",a),$(a.message)}finally{y(!1)}},V=(!!h.stripe_default_price_id||!!_)&&(f===void 0||f>0),Z=t=>{t.preventDefault(),t.stopPropagation(),L(!0)},H=()=>{L(!1)},W=async t=>{if(o&&i)try{if(console.log(`Saving changes for product ${i}:`,t),await fetch(`${{}.VITE_SUPABASE_URL}/functions/v1/manage-product`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("supabase.auth.token")}`},body:JSON.stringify({store_id:o,product_id:i,...t})}),b(a=>({...a,...t})),s&&s.id===o&&s.products){const a=s.products.map(c=>c.id===i?{...c,...t}:c);S(o,{products:a})}else s&&s.id===o&&!s.products&&S(o,{products:[{...h,...t}]});L(!1)}catch(a){console.error("Failed to save product changes:",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.4,delay:p*.05,ease:"easeOut"},whileHover:{y:-8,boxShadow:"0px 10px 20px rgba(0,0,0,0.1)"},className:"product-card h-full",children:e.jsxs(Q,{className:"h-full overflow-hidden border hover:border-primary/50 transition-all duration-300 flex flex-col group bg-card shadow-sm hover:shadow-lg",children:[e.jsxs(M,{to:`/${v}/product/${O}`,className:"block",children:[" ",e.jsxs("div",{className:"aspect-square relative overflow-hidden bg-muted",children:[e.jsx("img",{alt:z,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",src:q}),e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 text-xs font-semibold text-white rounded-full shadow-md",style:{backgroundColor:m.primaryColor},children:"NEW"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:e.jsx(X,{className:"h-10 w-10 text-white"})})]})]}),e.jsxs(Y,{className:"p-4 flex-grow",children:[e.jsxs(M,{to:`/${v}/product/${O}`,className:"block",children:[" ",e.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[e.jsx("h3",{className:"font-semibold text-md lg:text-lg line-clamp-2 group-hover:text-primary transition-colors",style:{"--hover-color":m.primaryColor},children:e.jsx(A,{initialText:u,onSave:t=>I("name",t),isAdmin:U,placeholder:"Product Name"})}),e.jsxs("span",{className:"font-bold text-md lg:text-lg whitespace-nowrap",style:{color:m.primaryColor},children:[T," ",typeof w=="number"?w.toFixed(2):"Price unavailable"]})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:e.jsx(A,{initialText:P,onSave:t=>I("description",t),isAdmin:U,placeholder:"Product Description"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[[...Array(5)].map((t,a)=>e.jsx(ee,{className:`h-3.5 w-3.5 ${a<Math.floor(g)?"fill-amber-400 text-amber-400":"text-muted-foreground/50"}`},a)),e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",g," reviews)"]})]}),N&&N.length>0&&e.jsx("div",{className:"mt-2.5",children:N.map((t,a)=>e.jsxs("div",{className:"mb-1.5 last:mb-0",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[t.name,": "]}),e.jsx("span",{className:"text-xs text-foreground",children:t.values&&Array.isArray(t.values)?t.values.join(", "):""})]},a))})]}),e.jsxs(te,{className:"p-4 pt-0 mt-auto flex flex-col gap-2",children:[e.jsxs(j,{className:"w-full transition-transform duration-200 hover:scale-105",style:{backgroundColor:m.primaryColor,color:m.primaryTextColor||"white"},onClick:D,disabled:r||f!==void 0&&f<=0,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),f!==void 0&&f<=0?"Out of Stock":"Add to Cart"]}),V&&e.jsxs(j,{variant:"outline",className:"w-full transition-transform duration-200 hover:scale-105",onClick:J,disabled:r,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),r?"Processing...":"Buy Now"]}),C&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:C}),U&&e.jsxs(j,{variant:"outline",className:"w-full transition-transform duration-200 hover:scale-105 mt-2",onClick:Z,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Edit Product"]})]})]})}),B&&e.jsx(re,{product:h,isOpen:B,onClose:H,onSave:W,storeId:o,theme:m})]})},fe=({store:l,isPublishedView:m=!1})=>{var E,S;const{products:p,theme:v,id:o,content:x}=l,{updateStore:h}=R(),b=!m,[u,w]=d.useState("grid"),[g,P]=d.useState(""),[n,T]=d.useState(p||[]),[i,_]=d.useState(!0),N=async(s,r)=>{if(o)try{await h(o,{content:{...x||{},[s]:r}})}catch(y){console.error(`Failed to update product grid text for ${s}:`,y)}};if(d.useEffect(()=>{const s=setTimeout(()=>{_(!1)},800);return()=>clearTimeout(s)},[]),d.useEffect(()=>{if(p)if(g.trim()==="")T(p);else{const s=p.filter(r=>{var y,C;return((y=r.name)==null?void 0:y.toLowerCase().includes(g.toLowerCase()))||((C=r.description)==null?void 0:C.toLowerCase().includes(g.toLowerCase()))});T(s)}},[g,p]),!p||p.length===0)return e.jsxs("section",{id:`products-${o}`,className:"py-12 container mx-auto px-4 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 font-poppins",children:"Our Products"}),e.jsx("p",{className:"text-muted-foreground",children:"No products available at the moment. Check back soon!"})]});const f=()=>e.jsxs("div",{className:"bg-card rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300",children:[e.jsx("div",{className:"aspect-square bg-muted animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-1/2"}),e.jsx("div",{className:"h-6 bg-muted rounded animate-pulse w-1/3 mt-2"})]})]});return e.jsx("section",{id:`products-${o}`,className:"py-12 bg-background",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-8",children:[(l.logo_url||((E=l.theme)==null?void 0:E.logo))&&e.jsx("img",{src:l.logo_url||((S=l.theme)==null?void 0:S.logo),alt:`${l.name||"Store"} Logo`,className:"h-[83px] md:h-[104px] mx-auto mb-4 object-contain"}),e.jsx(A,{initialText:(x==null?void 0:x.productGridTitle)||"Featured Products",onSave:s=>N("productGridTitle",s),isAdmin:b,placeholder:"Section Title",as:"h2",textClassName:"text-3xl md:text-5xl font-bold mb-3 tracking-tight font-poppins bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent",className:"w-full"}),e.jsx(A,{initialText:(x==null?void 0:x.productGridSubtitle)||"Explore our curated selection of high-quality items, handpicked for you.",onSave:s=>N("productGridSubtitle",s),isAdmin:b,placeholder:"Section Subtitle",as:"div",textClassName:"text-muted-foreground max-w-xl mx-auto text-md md:text-lg",className:"w-full mt-2",useTextarea:!0})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"w-full pl-10 pr-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-primary/20 bg-background",value:g,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"icon",className:u==="grid"?"bg-primary/10":"",onClick:()=>w("grid"),children:e.jsx(ne,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"icon",className:u==="list"?"bg-primary/10":"",onClick:()=>w("list"),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs(j,{variant:"outline",className:"gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Filter"})]})]})]}),e.jsx(ce,{mode:"wait",children:i?e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:u==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8":"space-y-4",children:Array(8).fill(0).map((s,r)=>e.jsx(f,{},`skeleton-${r}`))},"loading"):e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{staggerChildren:.05},className:u==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8":"space-y-4",children:n.map((s,r)=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:r*.05},className:u==="list"?"w-full":"",children:e.jsx(pe,{product:s,theme:v,index:r,storeName:de(l.name),storeId:o,isPublishedView:m,displayMode:u})},s.id||`product-${r}`))},"products")}),n.length===0&&!i&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-muted-foreground",children:"No products found matching your search."}),e.jsx(j,{onClick:()=>P(""),className:"mt-4",style:{backgroundColor:v.primaryColor},children:"Clear Search"})]})]})})};export{fe as default};
