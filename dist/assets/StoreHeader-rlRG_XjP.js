import{y as le,r as k,K as ne,j as e,z as O,G as L,B as l,_ as B,F as T,$ as V,a0 as _,a1 as H,Q as ie,a2 as Q,a3 as ce,a4 as de,A as X,a5 as Y,R as G,N as me,a6 as he,a7 as xe,a8 as ue,X as K}from"./index-DQzOWQZE.js";const ge=({store:i,isPublishedView:m=!1})=>{const{name:n,theme:o,logo_url:h,id:t,settings:u,content:c,template_version:U}=i,{cart:W,removeFromCart:J,updateQuantity:D,updateStore:z,updateStoreTemplateVersion:j}=le(),[Z,p]=k.useState(!1),[P,N]=k.useState(!1),[ee,F]=k.useState(!1),x=!m,[g,I]=k.useState(!1),$=ne(),y=W.filter(s=>s.storeId===t),R=y.reduce((s,a)=>s+a.quantity,0),se=y.reduce((s,a)=>s+a.price*a.quantity,0);k.useEffect(()=>{const s=localStorage.getItem("theme"),a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;I(!!(s==="dark"||!s&&a))},[]);const C=async(s,a,r=null)=>{if(t)try{if(s==="storeName")await z(t,{name:a});else if(s==="navLink"&&r!==null){const S=((c==null?void 0:c.navLinks)||M.map(b=>({label:b.label,href:b.href}))).map((b,oe)=>oe===r?{...b,label:a}:b);await z(t,{content:{...c,navLinks:S}})}await ae()}catch(d){console.error(`Failed to update store ${s} or refresh template:`,d)}},ae=async()=>{const s=U||"v1";console.log(`Performing template refresh. Current version: ${s}`),s==="v1"?(await j(t,"v2"),await j(t,"v1"),console.log("Template refreshed: v1 -> v2 -> v1")):s==="v2"&&(await j(t,"v1"),await j(t,"v2"),console.log("Template refreshed: v2 -> v1 -> v2"))},q=()=>{F(!0),console.log("Open change image dialog (placeholder)")},te=async s=>{if(t&&s)try{await z(t,{logo_url:s}),console.log("Store logo updated successfully. Setting template to modern (v2)."),await j(t,"v2"),console.log("Store template set to modern (v2).")}catch(a){console.error("Failed to update store logo or set template to modern:",a)}},E=()=>{const s=!g;I(s),s?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},f=`/store/${t}`,w=[{href:f,label:"Home"},{href:`#products-${t}`,label:"Products"},{href:`#features-${t}`,label:"Features"},{href:`#contact-${t}`,label:"Contact"}],M=c!=null&&c.navLinks&&c.navLinks.length===w.length?c.navLinks.map((s,a)=>({...w[a],label:s.label||w[a].label})):w,A=(s,a)=>{if(s.preventDefault(),p(!1),a.startsWith("/store/"))$(a);else{const r=a.substring(1),d=document.getElementById(r);d?d.scrollIntoView({behavior:"smooth"}):$(f)}},re=()=>{N(!1),$("/checkout",{state:{cart:y,storeName:n,storeId:t}})};return e.jsxs(e.Fragment,{children:[e.jsx(O.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},className:"sticky top-0 z-40 w-full bg-background/90 backdrop-blur-md border-b",style:{borderColor:`${o.primaryColor}30`},children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[" ",e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(L,{to:f,className:"group",children:h&&e.jsx("img",{src:h,alt:`${n} logo`,className:"h-16 w-16 object-contain group-hover:scale-105 transition-transform duration-200"})}),x&&h&&e.jsx(l,{variant:"outline",size:"icon",onClick:q,className:"absolute top-0 right-0 h-7 w-7 p-1 bg-background/75 hover:bg-muted rounded-full -mr-2 -mt-2 z-10 shadow-md",children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsx(L,{to:f,className:"group ml-2",children:e.jsx("span",{className:"font-bold text-xl tracking-tight group-hover:text-primary transition-colors",style:{color:o.primaryColor},children:e.jsx(T,{initialText:n,onSave:s=>C("storeName",s),isAdmin:x,placeholder:"Store Name"})})})]})," ",e.jsx("nav",{className:"hidden md:flex items-center gap-x-6",children:M.map((s,a)=>e.jsx("a",{href:s.href,onClick:r=>A(r,s.href),className:"text-sm font-medium text-muted-foreground hover:text-primary transition-colors",style:{"--hover-color":o.primaryColor},children:e.jsx(T,{initialText:s.label,onSave:r=>C("navLink",r,a),isAdmin:x,placeholder:`Link ${a+1}`})},s.label+a))}),e.jsxs("div",{className:"flex items-center gap-2",children:[((u==null?void 0:u.showThemeToggle)??!0)&&e.jsxs("div",{className:"hidden md:flex items-center gap-2 mr-2",children:[e.jsx(V,{id:`store-theme-switcher-${t}`,checked:g,onCheckedChange:E,"aria-label":"Toggle dark mode"}),g?e.jsx(_,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(H,{className:"h-5 w-5 text-muted-foreground"})]}),e.jsx(l,{variant:"ghost",size:"icon",className:"hidden md:flex text-muted-foreground hover:text-primary",style:{"--hover-color":o.primaryColor},children:e.jsx(ie,{className:"h-5 w-5"})}),e.jsxs(l,{variant:"outline",className:"relative",onClick:()=>N(!0),style:{borderColor:o.primaryColor,color:o.primaryColor},children:[e.jsx(Q,{className:"h-5 w-5"}),R>0&&e.jsx(ce,{variant:"destructive",className:"absolute -top-2 -right-2 h-5 w-5 p-0 flex items-center justify-center text-xs",style:{backgroundColor:o.secondaryColor||"red"},children:R}),e.jsx("span",{className:"ml-2 hidden sm:inline",children:"Cart"})]}),e.jsx(l,{variant:"ghost",size:"icon",className:"md:hidden text-muted-foreground hover:text-primary",onClick:()=>p(!0),style:{"--hover-color":o.primaryColor},children:e.jsx(de,{className:"h-6 w-6"})})]})]})}),e.jsx(X,{children:Z&&e.jsxs(O.div,{initial:{opacity:0,x:"100%"},animate:{opacity:1,x:0},exit:{opacity:0,x:"100%"},transition:{type:"spring",stiffness:300,damping:30},className:"fixed inset-0 z-50 bg-background p-6 md:hidden",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[" ",e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(L,{to:f,className:"group",onClick:()=>p(!1),children:h&&e.jsx("img",{src:h,alt:`${n} logo`,className:"h-16 w-16 object-contain"})}),x&&h&&e.jsx(l,{variant:"outline",size:"icon",onClick:()=>{q(),p(!1)},className:"absolute top-0 right-0 h-7 w-7 p-1 bg-background/75 hover:bg-muted rounded-full -mr-2 -mt-2 z-10 shadow-md",children:e.jsx(B,{className:"h-4 w-4"})})]}),e.jsx(L,{to:f,className:"group ml-2",onClick:()=>p(!1),children:e.jsx("span",{className:"font-bold text-xl",style:{color:o.primaryColor},children:e.jsx(T,{initialText:n,onSave:s=>C("storeName",s),isAdmin:x,placeholder:"Store Name"})})})]})," ",e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>p(!1),children:e.jsx(Y,{className:"h-6 w-6"})})]}),e.jsxs("nav",{className:"flex flex-col gap-y-4",children:[M.map((s,a)=>e.jsx("a",{href:s.href,onClick:r=>A(r,s.href),className:"text-lg font-medium text-foreground hover:text-primary transition-colors",style:{"--hover-color":o.primaryColor},children:e.jsx(T,{initialText:s.label,onSave:r=>C("navLink",r,a),isAdmin:x,placeholder:`Link ${a+1}`})},s.label+a)),((u==null?void 0:u.showThemeToggle)??!0)&&e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t border-border",children:[e.jsx(V,{id:`mobile-store-theme-switcher-${t}`,checked:g,onCheckedChange:E,"aria-label":"Toggle dark mode"}),g?e.jsx(_,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(H,{className:"h-5 w-5 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:g?"Dark Mode":"Light Mode"})]})]})]})}),e.jsx(X,{children:P&&e.jsx(v.Root,{open:P,onOpenChange:N,children:e.jsxs(v.Portal,{children:[e.jsx(v.Overlay,{className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm"}),e.jsxs(v.Content,{className:"fixed z-50 inset-y-0 right-0 h-full w-full max-w-md bg-background border-l shadow-xl flex flex-col",as:O.div,initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",stiffness:300,damping:30},children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Your Cart"}),e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>N(!1),children:e.jsx(Y,{className:"h-5 w-5"})})]}),y.length===0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6 text-center",children:[e.jsx(Q,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Your cart is empty"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Looks like you haven't added anything yet."}),e.jsx(l,{onClick:()=>N(!1),className:"mt-6",style:{backgroundColor:o.primaryColor},children:"Continue Shopping"})]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"flex-1 p-6",children:e.jsx("div",{className:"space-y-4",children:y.map(s=>{var a,r,d,S;return e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:((r=(a=s.image)==null?void 0:a.src)==null?void 0:r.tiny)||((S=(d=s.image)==null?void 0:d.src)==null?void 0:S.medium)||`https://via.placeholder.com/80x80.png?text=${s.name.substring(0,1)}`,alt:s.name,className:"w-20 h-20 object-cover rounded-md border"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-sm line-clamp-1",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Price: $",s.price.toFixed(2)]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(l,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>D(s.id,t,s.quantity-1),children:e.jsx("span",{className:"text-lg leading-none",children:"-"})}),e.jsx("span",{className:"text-sm w-4 text-center",children:s.quantity}),e.jsx(l,{variant:"outline",size:"icon",className:"h-6 w-6",onClick:()=>D(s.id,t,s.quantity+1),children:e.jsx("span",{className:"text-lg leading-none",children:"+"})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-sm",children:["$",(s.price*s.quantity).toFixed(2)]}),e.jsx(l,{variant:"ghost",size:"icon",className:"h-7 w-7 mt-1 text-muted-foreground hover:text-destructive",onClick:()=>J(s.id,t),children:e.jsx(he,{className:"h-4 w-4"})})]})]},s.id)})})}),e.jsx(xe,{}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["$",se.toFixed(2)]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Shipping and taxes calculated at checkout."}),e.jsx(l,{className:"w-full",size:"lg",style:{backgroundColor:o.primaryColor},onClick:re,children:"Proceed to Checkout"})]})]})]})]})})}),x&&e.jsx(ue,{open:ee,onOpenChange:F,storeId:t,storeName:n,currentLogoUrl:h,onLogoReplaced:te})]})},v={Root:({children:i,...m})=>e.jsx("div",{...m,children:i}),Portal:({children:i})=>e.jsx(e.Fragment,{children:i}),Overlay:G.forwardRef(({className:i,...m},n)=>e.jsx("div",{ref:n,className:K("fixed inset-0 z-50",i),...m})),Content:G.forwardRef(({className:i,children:m,...n},o)=>e.jsx("div",{ref:o,className:K("fixed z-50",i),...n,children:m}))};v.Overlay.displayName="DialogPrimitive.Overlay";v.Content.displayName="DialogPrimitive.Content";export{ge as default};
