import{ai as z,r as a,j as e,aj as H,ak as R,al as W,am as Y,an as _,ao as J,ap as K,aq as P,ar as C,as as D,y as S,at as k,B as c,au as X,av as Z,aw as O,ax as ee}from"./index-45811221.js";const ae=({open:j,onOpenChange:s,storeId:I,currentVideoUrl:V,onVideoReplaced:r})=>{const{user:E}=z(),[L,G]=a.useState("ai"),[u,N]=a.useState(""),[f,h]=a.useState(!1),[F,x]=a.useState(null),[b,U]=a.useState(""),[g,w]=a.useState(null),[i,y]=a.useState(!1),[A,l]=a.useState(null),[n,m]=a.useState(null),[T,o]=a.useState(null),[v,p]=a.useState(!1);a.useEffect(()=>{j&&(N(""),h(!1),x(null),U(""),w(null),y(!1),l(null),m(null),o(null),p(!1))},[j]);const M=async()=>{if(!u.trim()){x("Please enter a prompt for the video.");return}h(!0),x(null);try{if(!await X(E.uid,15)){x("You don't have enough credits to generate a video."),h(!1);return}console.log(`Generating video for store ${I} with prompt: "${u}"`);const d=await Z(u);r&&r(d),await O(E.uid,15),s(!1),N("")}catch(t){console.error("Error generating video with AI:",t),x(t.message||"Failed to generate video. Please try again.")}finally{h(!1)}},B=async()=>{if(!b.trim()){l("Please enter a search query for Pexels.");return}y(!0),l(null),w(null);try{const t=await ee(b);t.error?l(t.error):t.video?w(t.video):l("No video found for your query.")}catch(t){console.error("Error searching Pexels videos:",t),l(t.message||"Failed to search Pexels. Please try again.")}finally{y(!1)}},q=t=>{r&&t?(r(t),s(!1)):l("Invalid video URL selected or replacement handler missing.")},Q=t=>{const d=t.target.files[0];if(d){if(d.size>50*1024*1024){o("File is too large. Please select a video under 50MB."),m(null);return}if(!d.type.startsWith("video/")){o("Invalid file type. Please select a video file."),m(null);return}m(d),o(null)}},$=()=>{if(n&&r){p(!0),o(null);const t=new FileReader;t.onloadend=()=>{r(t.result),s(!1),m(null),p(!1)},t.onerror=()=>{o("Failed to read video file for upload."),p(!1)},t.readAsDataURL(n)}else o("No video file selected or replacement handler missing.")};return e.jsx(H,{open:j,onOpenChange:s,children:e.jsxs(R,{className:"w-[90vw] sm:max-w-[672px] bg-slate-900 border-slate-700",children:[e.jsxs(W,{className:"text-left",children:[e.jsx(Y,{className:"text-white font-mono uppercase tracking-wide",children:"Replace Hero Video"}),e.jsxs(_,{className:"text-left text-slate-400",children:["Current video:"," ",e.jsx("a",{href:V,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 underline truncate block max-w-full",children:V||"No video set"})]})]}),e.jsxs(J,{value:L,onValueChange:G,className:"w-full",children:[e.jsxs(K,{className:"grid w-full grid-cols-3 bg-slate-800 border-slate-700",children:[e.jsx(P,{value:"ai",className:"text-slate-300 data-[state=active]:bg-blue-600 data-[state=active]:text-white font-mono",children:"AI Generation (Veo)"}),e.jsx(P,{value:"pexels",className:"text-slate-300 data-[state=active]:bg-blue-600 data-[state=active]:text-white font-mono",children:"Search Pexels"}),e.jsx(P,{value:"upload",className:"text-slate-300 data-[state=active]:bg-blue-600 data-[state=active]:text-white font-mono",children:"Upload Video"})]}),e.jsxs(C,{value:"ai",className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"aiPrompt",className:"text-left block mb-1 text-slate-300 font-mono",children:"AI Video Prompt"}),e.jsx(S,{id:"aiPrompt",value:u,onChange:t=>N(t.target.value),placeholder:"e.g., Military tactical gear in action",disabled:f,className:"bg-slate-800 border-slate-600 text-white placeholder:text-slate-400 font-mono"})]}),F&&e.jsx("p",{className:"text-sm text-blue-400 text-center font-mono",children:F}),e.jsxs(k,{className:"justify-start pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>s(!1),disabled:f,className:"border-slate-600 text-slate-300 hover:bg-slate-800 font-mono",children:"Cancel"}),e.jsx(c,{onClick:M,disabled:f||!u.trim(),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-mono",children:f?"Generating...":"Generate Video"})]})]}),e.jsxs(C,{value:"pexels",className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{id:"pexelsQuery",value:b,onChange:t=>U(t.target.value),placeholder:"e.g., Military, Tactical, Combat",disabled:i,className:"flex-grow bg-slate-800 border-slate-600 text-white placeholder:text-slate-400 font-mono"}),e.jsx(c,{onClick:B,disabled:i||!b.trim(),className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-mono",children:i?"Searching...":"Search"})]}),A&&e.jsx("p",{className:"text-sm text-blue-400 text-center font-mono",children:A}),i&&e.jsx("p",{className:"text-sm text-slate-400 text-center font-mono",children:"Loading Pexels video..."}),!i&&g&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative aspect-video rounded-md overflow-hidden cursor-pointer group border border-slate-700 hover:border-blue-600 w-full max-w-md",onClick:()=>q(g.videoUrl),children:[e.jsx("img",{src:g.imageUrl,alt:`Pexels video by ${g.photographer}`,className:"w-full h-full object-cover transition-transform group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 group-hover:bg-black/50 transition-colors flex items-center justify-center",children:e.jsx("p",{className:"text-white text-lg font-semibold text-center p-2 bg-black/50 rounded font-mono",children:"Use This Video"})})]})}),e.jsx(k,{className:"justify-start pt-4",children:e.jsx(c,{variant:"outline",onClick:()=>s(!1),disabled:i,className:"border-slate-600 text-slate-300 hover:bg-slate-800 font-mono",children:"Cancel"})})]}),e.jsxs(C,{value:"upload",className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"video-upload-input",className:"text-left block mb-1 text-slate-300 font-mono",children:"Select Video File"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(S,{id:"video-upload-input",type:"file",accept:"video/*",onChange:Q,className:"flex-grow bg-slate-800 border-slate-600 text-white font-mono",disabled:v})}),n&&e.jsxs("p",{className:"text-sm text-slate-400 mt-2 font-mono",children:["Selected: ",n.name," (",(n.size/1024/1024).toFixed(2)," MB)"]}),T&&e.jsx("p",{className:"text-sm text-blue-400 text-center mt-2 font-mono",children:T})]}),e.jsxs(k,{className:"justify-start pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>s(!1),disabled:v,className:"border-slate-600 text-slate-300 hover:bg-slate-800 font-mono",children:"Cancel"}),e.jsx(c,{onClick:$,disabled:v||!n,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white font-mono",children:v?"Uploading...":"Confirm Upload"})]})]})]})]})})};export{ae as R};
