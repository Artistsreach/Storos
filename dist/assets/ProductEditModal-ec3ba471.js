import{o as J,r as h,x as K,j as e,ai as D,aj as E,ak as A,al as I,am as Q,ag as W,C as S,ar as d,y as u,aF as X,B as c,ah as C,aG as Y,aH as U,S as Z,aI as w,as as ee,aE as O}from"./index-ed27cf41.js";const re=J("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),ae=g=>new Promise((x,i)=>{const m=new FileReader;m.readAsDataURL(g),m.onload=()=>x(m.result),m.onerror=b=>i(b)}),ne=({isOpen:g,onClose:x,product:i,onSave:m,storeId:b,theme:se})=>{const[n,l]=h.useState(null),[v,N]=h.useState(!1);h.useState(!1);const[k,P]=h.useState(null),[V,f]=h.useState(!1),{toast:j}=K();h.useEffect(()=>{var a,s;i&&l({...i,images:Array.isArray(i.images)?[...i.images]:(s=(a=i.image)==null?void 0:a.src)!=null&&s.medium?[i.image.src.medium]:[],variants:Array.isArray(i.variants)?i.variants.map(t=>({...t,values:Array.isArray(t.values)?[...t.values]:[]})):[]})},[i]);const y=(a,s)=>{l(t=>({...t,[a]:s}))},F=async a=>{if(a)try{const s=await ae(a);l(t=>{const r=Array.isArray(t.images)?t.images:[];return{...t,images:[...r,s]}})}catch(s){console.error("Error converting file to base64:",s),j({title:"Image Upload Error",description:"Could not process image.",variant:"destructive"})}},z=a=>{l(s=>({...s,images:s.images.filter((t,r)=>r!==a)}))},T=async()=>{j({title:"Image Generation",description:"AI Image generation for this product is not yet implemented here."}),console.log("Attempting to generate image for product:",n.name)},L=(a,s)=>{l(t=>{const r=[...t.variants||[]];return r[a]={...r[a],name:s},{...t,variants:r}})},_=(a,s,t)=>{l(r=>{const o=[...r.variants||[]],p={...o[a]};return p.values=[...p.values||[]],p.values[s]=t,o[a]=p,{...r,variants:o}})},B=a=>{l(s=>{const t=[...s.variants||[]],r={...t[a]};return r.values=[...r.values||[],""],t[a]=r,{...s,variants:t}})},G=(a,s)=>{l(t=>{const r=[...t.variants||[]],o={...r[a]};return o.values=(o.values||[]).filter((p,q)=>q!==s),r[a]=o,{...t,variants:r}})},R=()=>{l(a=>({...a,variants:[...a.variants||[],{name:"",values:[""]}]}))},M=a=>{l(s=>({...s,variants:(s.variants||[]).filter((t,r)=>r!==a)}))},$=async()=>{if(N(!0),!n.name||n.name.trim()===""||n.price===void 0||String(n.price).trim()===""){j({title:"Missing Information",description:"Please ensure the product has a name and a valid price.",variant:"destructive"}),N(!1);return}try{await m(n)}catch{j({title:"Save Error",description:"Could not save product changes.",variant:"destructive"})}finally{N(!1)}},H=a=>{P(a),f(!0)};return!g||!n?null:e.jsxs(e.Fragment,{children:[e.jsx(D,{open:g,onOpenChange:a=>!a&&x(),children:e.jsxs(E,{className:"max-w-2xl",children:[e.jsxs(A,{children:[e.jsxs(I,{children:["Edit Product: ",i.name]}),e.jsx(Q,{children:"Make changes to the product details below."})]}),e.jsx(W,{className:"max-h-[60vh] p-1",children:e.jsx("div",{className:"space-y-4 pr-4",children:e.jsxs(S,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"productName-edit",children:"Product Name"}),e.jsx(u,{id:"productName-edit",value:n.name,onChange:a=>y("name",a.target.value),placeholder:"Product Name"})]}),e.jsxs("div",{children:[e.jsxs(d,{htmlFor:"productPrice-edit",children:["Price (",n.currencyCode||"USD",")"]}),e.jsx(u,{id:"productPrice-edit",type:"number",value:n.price,onChange:a=>y("price",parseFloat(a.target.value)),placeholder:"0.00"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"productDescription-edit",children:"Description"}),e.jsx(X,{id:"productDescription-edit",value:n.description,onChange:a=>y("description",a.target.value),placeholder:"Product Description",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Product Images"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(n.images||[]).map((a,s)=>e.jsxs("div",{className:"relative group w-24 h-24 cursor-pointer",onClick:()=>H(a),children:[e.jsx("img",{src:a,alt:`Product image ${s+1}`,className:"w-full h-full object-contain rounded-md border"}),e.jsx(c,{variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-5 w-5 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:t=>{t.stopPropagation(),z(s)},children:e.jsx(C,{className:"h-3 w-3"})})]},s))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("productImageUpload-edit").click(),children:[e.jsx(Y,{className:"mr-2 h-4 w-4"})," Upload"]}),e.jsx(u,{id:"productImageUpload-edit",type:"file",accept:"image/*",className:"hidden",onChange:a=>F(a.target.files[0])}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:T,disabled:v||!n.name,children:[v?e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Generate Image (AI)"]})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t mt-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-muted-foreground",children:"Product Variants"}),(n.variants||[]).map((a,s)=>e.jsxs(S,{className:"p-2 space-y-2 bg-muted/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{htmlFor:`variantName-edit-${s}`,className:"text-xs",children:"Option Name"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>M(s),className:"h-6 w-6",children:e.jsx(C,{className:"h-3 w-3 text-destructive"})})]}),e.jsx(u,{id:`variantName-edit-${s}`,value:a.name||"",onChange:t=>L(s,t.target.value),placeholder:"e.g., Color, Size",className:"text-sm h-8"}),e.jsx(d,{className:"text-xs",children:"Option Values"}),(a.values||[]).map((t,r)=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{value:t||"",onChange:o=>_(s,r,o.target.value),placeholder:"e.g., Red",className:"text-sm h-8"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>G(s,r),className:"h-6 w-6",children:e.jsx(C,{className:"h-3 w-3 text-destructive"})})]},r)),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>B(s),className:"text-xs h-7",children:[e.jsx(w,{className:"mr-1 h-3 w-3"})," Add Value"]})]},s)),e.jsxs(c,{variant:"outline",onClick:R,className:"w-full text-sm h-8",children:[e.jsx(w,{className:"mr-2 h-4 w-4"})," Add Variant Option"]})]}),e.jsxs("div",{className:"pt-3 border-t mt-3",children:[e.jsx(d,{htmlFor:"productInventory-edit",children:"Inventory Count"}),e.jsx(u,{id:"productInventory-edit",type:"number",value:n.inventory_count||"",onChange:a=>y("inventory_count",parseInt(a.target.value)||0),placeholder:"0"})]})]})})}),e.jsxs(ee,{children:[e.jsx(O,{asChild:!0,children:e.jsx(c,{type:"button",variant:"outline",onClick:x,children:"Cancel"})}),e.jsxs(c,{type:"button",onClick:$,disabled:v,children:[v?e.jsx(U,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Save Changes"]})]})]})}),V&&k&&e.jsx(D,{open:V,onOpenChange:f,children:e.jsxs(E,{className:"max-w-xl max-h-[80vh]",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Enlarged Image"}),e.jsx(O,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"icon",className:"absolute top-4 right-4",onClick:()=>f(!1),children:e.jsx(w,{className:"h-4 w-4 rotate-45"})})})]}),e.jsx("div",{className:"flex justify-center items-center p-4",children:e.jsx("img",{src:k,alt:"Enlarged product",className:"max-w-full max-h-[70vh] object-contain"})})]})})]})};export{re as L,ne as P};
