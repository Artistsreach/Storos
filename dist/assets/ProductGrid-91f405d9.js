import{r as d,u as I,j as e,m as k,C as X,L as M,E as Y,g as V,I as E,c as ee,h as te,B as j,i as se,Z as ae,k as oe,s as re,l as ie,G as le,A as ne,n as ce}from"./index-ed27cf41.js";import{P as de,L as ue}from"./ProductEditModal-ec3ba471.js";import{F as me}from"./filter-16a345c2.js";const pe=({product:l,theme:m,index:p,storeName:v,storeId:o,isPublishedView:x=!1})=>{var B;const[h,b]=d.useState(l);d.useEffect(()=>{b(l)},[l]);const{name:u,price:w,rating:g,description:P,image:n,currencyCode:T="USD",id:r,stripe_price_id:A,variants:N,inventory_count:f}=h,{addToCart:$,updateStore:C,currentStore:s}=I(),[i,y]=d.useState(!1),[S,_]=d.useState(null),[U,L]=d.useState(!1),F=!x,G=(t=>typeof t=="string"&&t.startsWith("gid://shopify/"))(r)?btoa(r):r,z=((B=n==null?void 0:n.src)==null?void 0:B.medium)||(n==null?void 0:n.url)||(Array.isArray(h.images)&&h.images.length>0?h.images[0]:`https://via.placeholder.com/400x400.png?text=${encodeURIComponent(u)}`),D=(n==null?void 0:n.alt)||`${u} product image`,q=async(t,a)=>{if(o&&r)try{console.log(`Attempting to save product ${r}: ${t} = ${a}`);const c={id:r,[t]:a};await fetch("https://uwbrgokfgelgxeonoqah.supabase.co/functions/v1/manage-product",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("supabase.auth.token")}`},body:JSON.stringify({store_id:o,product_id:r,[t]:a})})}catch(c){console.error(`Failed to update product ${t}:`,c)}},J=t=>{t.preventDefault(),t.stopPropagation(),$(l,o)},R=async t=>{t.preventDefault(),t.stopPropagation(),y(!0),_(null);try{const a=await fetch("https://uwbrgokfgelgxeonoqah.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform_product_id:r,store_id:o,quantity:1})}),c=await a.json();if(!a.ok)throw new Error(c.error||"Failed to create checkout session.");if(c.checkoutUrl)window.location.href=c.checkoutUrl;else if(c.sessionId){const Q=await re,{error:O}=await Q.redirectToCheckout({sessionId:c.sessionId});O&&(console.error("Stripe redirect error:",O),_(O.message))}else throw new Error("Checkout session created, but no URL or Session ID returned.")}catch(a){console.error("Checkout error:",a),_(a.message)}finally{y(!1)}},W=(!!h.stripe_default_price_id||!!A)&&(f===void 0||f>0),Z=t=>{t.preventDefault(),t.stopPropagation(),L(!0)},H=()=>{L(!1)},K=async t=>{if(o&&r)try{if(console.log(`Saving changes for product ${r}:`,t),await fetch("https://uwbrgokfgelgxeonoqah.supabase.co/functions/v1/manage-product",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("supabase.auth.token")}`},body:JSON.stringify({store_id:o,product_id:r,...t})}),b(a=>({...a,...t})),s&&s.id===o&&s.products){const a=s.products.map(c=>c.id===r?{...c,...t}:c);C(o,{products:a})}else s&&s.id===o&&!s.products&&C(o,{products:[{...h,...t}]});L(!1)}catch(a){console.error("Failed to save product changes:",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(k.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.4,delay:p*.05,ease:"easeOut"},whileHover:{y:-8,boxShadow:"0px 10px 20px rgba(0,0,0,0.1)"},className:"product-card h-full",children:e.jsxs(X,{className:"h-full overflow-hidden border hover:border-primary/50 transition-all duration-300 flex flex-col group bg-card shadow-sm hover:shadow-lg",children:[e.jsxs(M,{to:`/${v}/product/${G}`,className:"block",children:[" ",e.jsxs("div",{className:"aspect-square relative overflow-hidden bg-muted",children:[e.jsx("img",{alt:D,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",src:z}),e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 text-xs font-semibold text-white rounded-full shadow-md",style:{backgroundColor:m.primaryColor},children:"NEW"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:e.jsx(Y,{className:"h-10 w-10 text-white"})})]})]}),e.jsxs(V,{className:"p-4 flex-grow",children:[e.jsxs(M,{to:`/${v}/product/${G}`,className:"block",children:[" ",e.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[e.jsx("h3",{className:"font-semibold text-md lg:text-lg line-clamp-2 group-hover:text-primary transition-colors",style:{"--hover-color":m.primaryColor},children:e.jsx(E,{initialText:u,onSave:t=>q("name",t),isAdmin:F,placeholder:"Product Name"})}),e.jsxs("span",{className:"font-bold text-md lg:text-lg whitespace-nowrap",style:{color:m.primaryColor},children:[T," ",typeof w=="number"?w.toFixed(2):"Price unavailable"]})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:e.jsx(E,{initialText:P,onSave:t=>q("description",t),isAdmin:F,placeholder:"Product Description"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[[...Array(5)].map((t,a)=>e.jsx(ee,{className:`h-3.5 w-3.5 ${a<Math.floor(g)?"fill-amber-400 text-amber-400":"text-muted-foreground/50"}`},a)),e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",g," reviews)"]})]}),N&&N.length>0&&e.jsx("div",{className:"mt-2.5",children:N.map((t,a)=>e.jsxs("div",{className:"mb-1.5 last:mb-0",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[t.name,": "]}),e.jsx("span",{className:"text-xs text-foreground",children:t.values&&Array.isArray(t.values)?t.values.join(", "):""})]},a))})]}),e.jsxs(te,{className:"p-4 pt-0 mt-auto flex flex-col gap-2",children:[e.jsxs(j,{className:"w-full transition-transform duration-200 hover:scale-105",style:{backgroundColor:m.primaryColor,color:m.primaryTextColor||"white"},onClick:J,disabled:i||f!==void 0&&f<=0,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),f!==void 0&&f<=0?"Out of Stock":"Add to Cart"]}),W&&e.jsxs(j,{variant:"outline",className:"w-full transition-transform duration-200 hover:scale-105",onClick:R,disabled:i,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),i?"Processing...":"Buy Now"]}),S&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:S}),F&&e.jsxs(j,{variant:"outline",className:"w-full transition-transform duration-200 hover:scale-105 mt-2",onClick:Z,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Edit Product"]})]})]})}),U&&e.jsx(de,{product:h,isOpen:U,onClose:H,onSave:K,storeId:o,theme:m})]})},ye=({store:l,isPublishedView:m=!1})=>{var $,C;const{products:p,theme:v,id:o,content:x}=l,{updateStore:h}=I(),b=!m,[u,w]=d.useState("grid"),[g,P]=d.useState(""),[n,T]=d.useState(p||[]),[r,A]=d.useState(!0),N=async(s,i)=>{if(o)try{await h(o,{content:{...x||{},[s]:i}})}catch(y){console.error(`Failed to update product grid text for ${s}:`,y)}};if(d.useEffect(()=>{const s=setTimeout(()=>{A(!1)},800);return()=>clearTimeout(s)},[]),d.useEffect(()=>{if(p)if(g.trim()==="")T(p);else{const s=p.filter(i=>{var y,S;return((y=i.name)==null?void 0:y.toLowerCase().includes(g.toLowerCase()))||((S=i.description)==null?void 0:S.toLowerCase().includes(g.toLowerCase()))});T(s)}},[g,p]),!p||p.length===0)return e.jsxs("section",{id:`products-${o}`,className:"py-12 container mx-auto px-4 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 font-poppins",children:"Our Products"}),e.jsx("p",{className:"text-muted-foreground",children:"No products available at the moment. Check back soon!"})]});const f=()=>e.jsxs("div",{className:"bg-card rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300",children:[e.jsx("div",{className:"aspect-square bg-muted animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-1/2"}),e.jsx("div",{className:"h-6 bg-muted rounded animate-pulse w-1/3 mt-2"})]})]});return e.jsx("section",{id:`products-${o}`,className:"py-12 bg-background",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-8",children:[(l.logo_url||(($=l.theme)==null?void 0:$.logo))&&e.jsx("img",{src:l.logo_url||((C=l.theme)==null?void 0:C.logo),alt:`${l.name||"Store"} Logo`,className:"h-[83px] md:h-[104px] mx-auto mb-4 object-contain"}),e.jsx(E,{initialText:(x==null?void 0:x.productGridTitle)||"Featured Products",onSave:s=>N("productGridTitle",s),isAdmin:b,placeholder:"Section Title",as:"h2",textClassName:"text-3xl md:text-5xl font-bold mb-3 tracking-tight font-poppins bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent",className:"w-full"}),e.jsx(E,{initialText:(x==null?void 0:x.productGridSubtitle)||"Explore our curated selection of high-quality items, handpicked for you.",onSave:s=>N("productGridSubtitle",s),isAdmin:b,placeholder:"Section Subtitle",as:"div",textClassName:"text-muted-foreground max-w-xl mx-auto text-md md:text-lg",className:"w-full mt-2",useTextarea:!0})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"w-full pl-10 pr-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-primary/20 bg-background",value:g,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"icon",className:u==="grid"?"bg-primary/10":"",onClick:()=>w("grid"),children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"icon",className:u==="list"?"bg-primary/10":"",onClick:()=>w("list"),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs(j,{variant:"outline",className:"gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Filter"})]})]})]}),e.jsx(ne,{mode:"wait",children:r?e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:u==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8":"space-y-4",children:Array(8).fill(0).map((s,i)=>e.jsx(f,{},`skeleton-${i}`))},"loading"):e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{staggerChildren:.05},className:u==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8":"space-y-4",children:n.map((s,i)=>e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:i*.05},className:u==="list"?"w-full":"",children:e.jsx(pe,{product:s,theme:v,index:i,storeName:ce(l.name),storeId:o,isPublishedView:m,displayMode:u})},s.id||`product-${i}`))},"products")}),n.length===0&&!r&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-muted-foreground",children:"No products found matching your search."}),e.jsx(j,{onClick:()=>P(""),className:"mt-4",style:{backgroundColor:v.primaryColor},children:"Clear Search"})]})]})})};export{ye as default};
