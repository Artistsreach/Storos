import{P as D,y as F,r as j,j as e,z as L,an as O,G as N,ao as G,ap as R,F as v,C as z,aq as J,B as C,a2 as W,ar as Z}from"./index-DQzOWQZE.js";const H=D("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),V=({product:c,theme:n,index:k,storeId:i,isPublishedView:S=!1})=>{var b;const{name:l,price:h,rating:m,description:P,image:r,currencyCode:$="USD",id:s,stripe_price_id:T}=c,{addToCart:_,updateStore:M}=F(),[d,x]=j.useState(!1),[f,p]=j.useState(null),y=!S,g=(t=>typeof t=="string"&&t.startsWith("gid://shopify/"))(s)?btoa(s):s,E=((b=r==null?void 0:r.src)==null?void 0:b.medium)||(r==null?void 0:r.url)||`https://via.placeholder.com/400x400.png?text=${encodeURIComponent(l)}`,U=(r==null?void 0:r.alt)||`${l} product image`,w=async(t,o)=>{if(i&&s)try{console.log(`Attempting to save product ${s}: ${t} = ${o}`);const a={id:s,[t]:o};await fetch("https://uwbrgokfgelgxeonoqah.supabase.co/functions/v1/manage-product",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("supabase.auth.token")}`},body:JSON.stringify({store_id:i,product_id:s,[t]:o})})}catch(a){console.error(`Failed to update product ${t}:`,a)}},A=t=>{t.preventDefault(),t.stopPropagation(),_(c,i)},B=async t=>{t.preventDefault(),t.stopPropagation(),x(!0),p(null);try{const o=await fetch("https://uwbrgokfgelgxeonoqah.supabase.co/functions/v1/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform_product_id:s,store_id:i,quantity:1})}),a=await o.json();if(!o.ok)throw new Error(a.error||"Failed to create checkout session.");if(a.checkoutUrl)window.location.href=a.checkoutUrl;else if(a.sessionId){const q=await Z,{error:u}=await q.redirectToCheckout({sessionId:a.sessionId});u&&(console.error("Stripe redirect error:",u),p(u.message))}else throw new Error("Checkout session created, but no URL or Session ID returned.")}catch(o){console.error("Checkout error:",o),p(o.message)}finally{x(!1)}},I=!!c.stripe_default_price_id||!!T;return e.jsx(L.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.4,delay:k*.05,ease:"easeOut"},whileHover:{y:-8,boxShadow:"0px 10px 20px rgba(0,0,0,0.1)"},className:"product-card h-full",children:e.jsxs(O,{className:"h-full overflow-hidden border hover:border-primary/50 transition-all duration-300 flex flex-col group bg-card shadow-sm hover:shadow-lg",children:[e.jsx(N,{to:`/store/${i}/product/${g}`,className:"block",children:e.jsxs("div",{className:"aspect-square relative overflow-hidden bg-muted",children:[e.jsx("img",{alt:U,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",src:E}),e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 text-xs font-semibold text-white rounded-full shadow-md",style:{backgroundColor:n.primaryColor},children:"NEW"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:e.jsx(G,{className:"h-10 w-10 text-white"})})]})}),e.jsxs(R,{className:"p-4 flex-grow",children:[e.jsx(N,{to:`/store/${i}/product/${g}`,className:"block",children:e.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[e.jsx("h3",{className:"font-semibold text-md lg:text-lg line-clamp-2 group-hover:text-primary transition-colors",style:{"--hover-color":n.primaryColor},children:e.jsx(v,{initialText:l,onSave:t=>w("name",t),isAdmin:y,placeholder:"Product Name"})}),e.jsxs("span",{className:"font-bold text-md lg:text-lg whitespace-nowrap",style:{color:n.primaryColor},children:[$," ",typeof h=="number"?h.toFixed(2):"Price unavailable"]})]})}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:e.jsx(v,{initialText:P,onSave:t=>w("description",t),isAdmin:y,placeholder:"Product Description"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[[...Array(5)].map((t,o)=>e.jsx(z,{className:`h-3.5 w-3.5 ${o<Math.floor(m)?"fill-amber-400 text-amber-400":"text-muted-foreground/50"}`},o)),e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",m," reviews)"]})]})]}),e.jsxs(J,{className:"p-4 pt-0 mt-auto flex flex-col gap-2",children:[e.jsxs(C,{className:"w-full transition-transform duration-200 hover:scale-105",style:{backgroundColor:n.primaryColor,color:n.primaryTextColor||"white"},onClick:A,disabled:d,children:[e.jsx(W,{className:"mr-2 h-4 w-4"}),"Add to Cart"]}),I&&e.jsxs(C,{variant:"outline",className:"w-full transition-transform duration-200 hover:scale-105",onClick:B,disabled:d,children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),d?"Processing...":"Buy Now"]}),f&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:f})]})]})})};export{V as P};
