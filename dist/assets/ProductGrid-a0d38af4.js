import{r as d,u as z,j as e,m as P,C as Q,L as I,E as X,g as Y,I as E,c as V,h as ee,B as j,i as te,Z as se,k as ae,l as oe,n as re,G as ie,A as le,o as ne}from"./index-eca7a0fb.js";import{L as ce}from"./list-6efefddd.js";import{F as de}from"./filter-c1749b41.js";const ue=({product:i,theme:u,index:m,storeName:b,storeId:o,isPublishedView:p=!1})=>{var q;const[x,w]=d.useState(i);d.useEffect(()=>{w(i)},[i]);const{name:c,price:N,rating:h,description:C,image:l,currencyCode:T="USD",id:n,stripe_price_id:A,variants:v,inventory_count:g}=x,{addToCart:$,updateStore:S,currentStore:s}=z(),[r,f]=d.useState(!1),[k,O]=d.useState(null),[U,_]=d.useState(!1),L=!p,B=encodeURIComponent(n),G=((q=l==null?void 0:l.src)==null?void 0:q.medium)||(l==null?void 0:l.url)||(Array.isArray(x.images)&&x.images.length>0?x.images[0]:`https://via.placeholder.com/400x400.png?text=${encodeURIComponent(c)}`),D=(l==null?void 0:l.alt)||`${c} product image`,M=async(t,a)=>{if(o&&n)try{console.log(`Attempting to save product ${n}: ${t} = ${a}`);const y={id:n,[t]:a};await fetch("https://uwbrgokfgelgxeonoqah.supabase.co/functions/v1/manage-product",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("supabase.auth.token")}`},body:JSON.stringify({store_id:o,product_id:n,[t]:a})})}catch(y){console.error(`Failed to update product ${t}:`,y)}},R=t=>{t.preventDefault(),t.stopPropagation(),$(i,o)},J=async t=>{t.preventDefault(),t.stopPropagation(),f(!0),O(null);try{const F=(await httpsCallable(functions,"createProductCheckoutSession")({productName:c,productDescription:C,productImage:G,amount:N*100,currency:"usd",storeOwnerId:s.merchantId})).data;if(F&&F.url)window.location.href=F.url;else throw new Error("Failed to create checkout session.")}catch(a){console.error("Checkout error:",a),O(a.message||"An unexpected error occurred.")}finally{f(!1)}},Z=(!!x.stripe_default_price_id||!!A)&&(g===void 0||g>0),H=t=>{t.preventDefault(),t.stopPropagation(),_(!0)},W=()=>{_(!1)},K=async t=>{if(o&&n)try{if(console.log(`Saving changes for product ${n}:`,t),await fetch("https://uwbrgokfgelgxeonoqah.supabase.co/functions/v1/manage-product",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("supabase.auth.token")}`},body:JSON.stringify({store_id:o,product_id:n,...t})}),w(a=>({...a,...t})),s&&s.id===o&&s.products){const a=s.products.map(y=>y.id===n?{...y,...t}:y);S(o,{products:a})}else s&&s.id===o&&!s.products&&S(o,{products:[{...x,...t}]});_(!1)}catch(a){console.error("Failed to save product changes:",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(P.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.4,delay:m*.05,ease:"easeOut"},whileHover:{y:-8,boxShadow:"0px 10px 20px rgba(0,0,0,0.1)"},className:"product-card h-full",children:e.jsxs(Q,{className:"h-full overflow-hidden border hover:border-primary/50 transition-all duration-300 flex flex-col group bg-card shadow-sm hover:shadow-lg",children:[e.jsxs(I,{to:`/${b}/product/${B}`,className:"block",children:[" ",e.jsxs("div",{className:"aspect-square relative overflow-hidden bg-muted",children:[e.jsx("img",{alt:D,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",src:G}),e.jsx("div",{className:"absolute top-3 right-3 px-2.5 py-1 text-xs font-semibold text-white rounded-full shadow-md",style:{backgroundColor:u.primaryColor},children:"NEW"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center",children:e.jsx(X,{className:"h-10 w-10 text-white"})})]})]}),e.jsxs(Y,{className:"p-4 flex-grow",children:[e.jsxs(I,{to:`/${b}/product/${B}`,className:"block",children:[" ",e.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[e.jsx("h3",{className:"font-semibold text-md lg:text-lg line-clamp-2 group-hover:text-primary transition-colors",style:{"--hover-color":u.primaryColor},children:e.jsx(E,{initialText:c,onSave:t=>M("name",t),isAdmin:L,placeholder:"Product Name"})}),e.jsxs("span",{className:"font-bold text-md lg:text-lg whitespace-nowrap",style:{color:u.primaryColor},children:[T," ",typeof N=="number"?N.toFixed(2):"Price unavailable"]})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mb-2",children:e.jsx(E,{initialText:C,onSave:t=>M("description",t),isAdmin:L,placeholder:"Product Description"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[[...Array(5)].map((t,a)=>e.jsx(V,{className:`h-3.5 w-3.5 ${a<Math.floor(h)?"fill-amber-400 text-amber-400":"text-muted-foreground/50"}`},a)),e.jsxs("span",{className:"text-xs text-muted-foreground ml-1",children:["(",h," reviews)"]})]}),v&&v.length>0&&e.jsx("div",{className:"mt-2.5",children:v.map((t,a)=>e.jsxs("div",{className:"mb-1.5 last:mb-0",children:[e.jsxs("span",{className:"text-xs font-medium text-muted-foreground",children:[t.name,": "]}),e.jsx("span",{className:"text-xs text-foreground",children:t.values&&Array.isArray(t.values)?t.values.join(", "):""})]},a))})]}),e.jsxs(ee,{className:"p-4 pt-0 mt-auto flex flex-col gap-2",children:[e.jsxs(j,{className:"w-full transition-transform duration-200 hover:scale-105",style:{backgroundColor:u.primaryColor,color:u.primaryTextColor||"white"},onClick:R,disabled:r||g!==void 0&&g<=0,children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),g!==void 0&&g<=0?"Out of Stock":"Add to Cart"]}),Z&&e.jsxs(j,{variant:"outline",className:"w-full transition-transform duration-200 hover:scale-105",onClick:J,disabled:r,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),r?"Processing...":"Buy Now"]}),k&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:k}),L&&e.jsxs(j,{variant:"outline",className:"w-full transition-transform duration-200 hover:scale-105 mt-2",onClick:H,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Edit Product"]})]})]})}),U&&e.jsx(oe,{product:x,isOpen:U,onClose:W,onSave:K,storeId:o,theme:u})]})},he=({store:i,isPublishedView:u=!1})=>{var $,S;const{products:m,theme:b,id:o,content:p}=i,{updateStore:x}=z(),w=!u,[c,N]=d.useState("grid"),[h,C]=d.useState(""),[l,T]=d.useState(m||[]),[n,A]=d.useState(!0),v=async(s,r)=>{if(o)try{await x(o,{content:{...p||{},[s]:r}})}catch(f){console.error(`Failed to update product grid text for ${s}:`,f)}};if(d.useEffect(()=>{const s=setTimeout(()=>{A(!1)},800);return()=>clearTimeout(s)},[]),d.useEffect(()=>{if(m)if(h.trim()==="")T(m);else{const s=m.filter(r=>{var f,k;return((f=r.name)==null?void 0:f.toLowerCase().includes(h.toLowerCase()))||((k=r.description)==null?void 0:k.toLowerCase().includes(h.toLowerCase()))});T(s)}},[h,m]),!m||m.length===0)return e.jsxs("section",{id:`products-${o}`,className:"py-12 container mx-auto px-4 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold mb-4 font-poppins",children:"Our Products"}),e.jsx("p",{className:"text-muted-foreground",children:"No products available at the moment. Check back soon!"})]});const g=()=>e.jsxs("div",{className:"bg-card rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300",children:[e.jsx("div",{className:"aspect-square bg-muted animate-pulse"}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-3/4"}),e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse w-1/2"}),e.jsx("div",{className:"h-6 bg-muted rounded animate-pulse w-1/3 mt-2"})]})]});return e.jsx("section",{id:`products-${o}`,className:"py-12 bg-background",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-8",children:[(i.logo_url||(($=i.theme)==null?void 0:$.logo))&&e.jsx("img",{src:i.logo_url||((S=i.theme)==null?void 0:S.logo),alt:`${i.name||"Store"} Logo`,className:"h-[83px] md:h-[104px] mx-auto mb-4 object-contain"}),e.jsx(E,{initialText:(p==null?void 0:p.productGridTitle)||"Featured Products",onSave:s=>v("productGridTitle",s),isAdmin:w,placeholder:"Section Title",as:"h2",textClassName:"text-3xl md:text-5xl font-bold mb-3 tracking-tight font-poppins bg-gradient-to-r from-foreground to-muted-foreground bg-clip-text text-transparent",className:"w-full"}),e.jsx(E,{initialText:(p==null?void 0:p.productGridSubtitle)||"Explore our curated selection of high-quality items, handpicked for you.",onSave:s=>v("productGridSubtitle",s),isAdmin:w,placeholder:"Section Subtitle",as:"div",textClassName:"text-muted-foreground max-w-xl mx-auto text-md md:text-lg",className:"w-full mt-2",useTextarea:!0})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8 gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-1/3",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"w-full pl-10 pr-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-primary/20 bg-background",value:h,onChange:s=>C(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",size:"icon",className:c==="grid"?"bg-primary/10":"",onClick:()=>N("grid"),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(j,{variant:"outline",size:"icon",className:c==="list"?"bg-primary/10":"",onClick:()=>N("list"),children:e.jsx(ce,{className:"h-4 w-4"})}),e.jsxs(j,{variant:"outline",className:"gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{children:"Filter"})]})]})]}),e.jsx(le,{mode:"wait",children:n?e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:c==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8":"space-y-4",children:Array(8).fill(0).map((s,r)=>e.jsx(g,{},`skeleton-${r}`))},"loading"):e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{staggerChildren:.05},className:c==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 md:gap-8":"space-y-4",children:l.map((s,r)=>e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:r*.05},className:c==="list"?"w-full":"",children:e.jsx(ue,{product:s,theme:b,index:r,storeName:ne(i.name),storeId:o,isPublishedView:u,displayMode:c})},s.id||`product-${r}`))},"products")}),l.length===0&&!n&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-muted-foreground",children:"No products found matching your search."}),e.jsx(j,{onClick:()=>C(""),className:"mt-4",style:{backgroundColor:b.primaryColor},children:"Clear Search"})]})]})})};export{he as default};
